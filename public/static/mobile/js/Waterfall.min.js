
// $(function(){ 
// 	$(window).scroll(function(){show()}); 
// 	function show() 
// 	{ 
// 		//var id = document.getElementById("")
// 		if($(window).scrollTop()+$(window).height()>$(document).height()) 
// 		{ 
// 			//ajaxRead(); 
// 			var a = document.getElementById("waterfall");
// 			a.innerHTML = "滚动条距顶部距离(页面超出窗口的高度)  ";
// 			//alert("ok")
// 		} 
// 	} 
// 	function ajaxRead() 
// 	{ 
// 		var html=""; 
// 		$.ajax({ 
// 			type:'get', 
// 			data:id;
// 			dataType:'json', 
// 			url:'http://api.flickr.com/services/feeds/photos_public.gne?tags=car&tagmode=any&format=json&jsoncallback=?', 
// 			beforeSend:function(){console.log('loading...')}, 
// 			success:function(data){ 
// 				$.each(data.items,function(i,item){ 
// 					html+='<div class="box">'; 
// 					html+='<h1>'+item.title+'</h1>'; 
// 					html+='<a hreft="'+item.link+'"><img src="'+item.media.m+'"/></a>' 
// 					html+='<div>'+item.tags+'</div>'; 
// 					html+='</div>'; 
// 				}); 
// 				$("#resText").append($(html)); 
// 			}, 
// 			complete:function(){console.log('mission acomplete.')} 
// 		}); 
// 	} 
// }) 


$(document).ready(function(){  
        var range = 10;             //距下边界长度/单位px  
        //var elemt = "10px";           //插入元素高度/单位px  
        var totalheight = 0;   
        var length = 8;
        var num = 1;//主体元素  
        $(window).scroll(function(){  
        	var linkurl = window.location.href;
        	if( linkurl.indexOf("rental")>0 || linkurl.indexOf("sale")>0 )
        	{
        		var param = "&tempid=1&ph=1";
        	}
        	else
        	{
        		var param = linkurl.split("?")[1];
        		var param = param.replace("classid=156","");
        	}
            var srollPos = $(window).scrollTop();    //滚动条距顶部距离(页面超出窗口的高度)  
            var dataparam  = $("#waterfall").attr("data-param");
            var data  =dataparam.split(",");
            var classid = data[0];
            var rents = data[1];
            var sum = $("#watertotal").html();
            var maxnum = Math.ceil(sum/length);//加载的最多次数
            
            if(sum==0 || maxnum<=1)
            {
            	return;
            }
            //totalheight = parseFloat($(window).height()) + parseFloat(srollPos);  
            //alert(totalheight)
           
           // if(($(document).height()-range) <= totalheight  && num <= maxnum) { 
            	 if( num < maxnum) { 
                   console.log(num);
            		 var data = $("#waterfall").attr("data");
                     if(data =="off")
                    {
                    	 return;
                   	 }
                	$.ajax({ 
            			type:'get', 
            			url:'/extend/ajax-Waterfall/control.php',
            			data:"enews=WaterFall&classid="+classid+"&rents="+rents+param+"&num="+num+"&length="+length+"&t="+Math.random(),
            			dataType:'json', 
            			beforeSend:function(){
            				console.log('loading...')
            				$("#waterfall").attr("data","off");
            				$("#waitmessage").show();
            			}, 
            			success:function(json){ 
            				if(json.resid ==0)
            				{
            					if(json.num>sum)
            					{
            						json.num =sum;
            					}
            					setTimeout(function(){
            						$("#waitmessage").hide();
            						$("#waterfall").append(json.html); 
            						$("#waternum").html(json.num); 
            						$("#waterfall").attr("data","on");
            					},1000);
            				}
            				if(json.resid ==1)
            				{
            					alert(json.html);
            				}
            			}
            		}); 
            	num++; 
            }  
        })
 }); 